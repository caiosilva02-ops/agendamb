<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Agenda Digital — Firebase (Compartilhada)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg:#071022;
      --card:#0b1220;
      --accent1:#7c3aed;
      --accent2:#06b6d4;
      --muted:#94a3b8;
      --success:#16a34a;
      --danger:#ef4444;
    }
    * { box-sizing:border-box; }
    body {
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background:linear-gradient(180deg,#071022 0%, #071730 60%);
      color:#e6eef8;
      margin:0;
      min-height:100vh;
    }
    .app { max-width:1200px; margin:20px auto; padding:18px; }
    header { display:flex; align-items:center; gap:12px; }
    .brand { font-weight:800; font-size:20px; }
    .tag { font-size:13px; color:var(--muted); }
    .grid { display:grid; grid-template-columns:380px 1fr 320px; gap:18px; margin-top:16px; }
    .card { background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01)); padding:14px; border-radius:12px; box-shadow:0 6px 20px rgba(2,6,23,0.6); }
    label { display:block; font-size:13px; color:var(--muted); margin-bottom:6px; }
    input, textarea, select {
      width:100%; padding:10px; border-radius:10px;
      border:1px solid rgba(255,255,255,0.04);
      background:transparent; color:inherit; font-size:14px;
    }
    textarea { min-height:90px; }
    .row { display:flex; gap:10px; }
    .btn {
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px; border-radius:10px; border:0; cursor:pointer;
    }
    .btn-primary {
      background:linear-gradient(90deg,var(--accent1),var(--accent2));
      color:white; font-weight:700;
    }
    .btn-ghost {
      background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted);
    }
    .small { padding:8px 10px; font-size:13px; }
    .events-list { display:grid; gap:10px; margin-top:10px; }
    .event {
      display:flex; justify-content:space-between; gap:12px;
      padding:12px; border-radius:10px;
      background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
      align-items:center;
    }
    .meta { display:flex; gap:12px; align-items:center; }
    .date-chip {
      background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));
      padding:8px 10px; border-radius:8px; text-align:center; min-width:84px;
    }
    .title { font-weight:700; }
    .muted { color:var(--muted); font-size:13px; }
    footer { margin-top:18px; color:var(--muted); font-size:13px; text-align:center; }
    /* Toast */
    .toast-wrap { position:fixed; right:18px; bottom:18px; display:flex; flex-direction:column; gap:8px; z-index:9999; }
    .toast {
      min-width:240px; padding:12px 14px; border-radius:10px; color:white;
      box-shadow:0 6px 20px rgba(2,6,23,0.6); font-weight:600;
      transition:opacity .4s;
    }
    .toast.success { background:var(--success); }
    .toast.error { background:var(--danger); }
    .toast.info { background:#0f1724; border:1px solid rgba(255,255,255,0.06); }
    .activity-list { max-height:360px; overflow:auto; padding-top:8px; }
    .activity { padding:8px; border-bottom:1px dashed rgba(255,255,255,0.02); font-size:13px; }
    .empty { color:var(--muted); padding:12px; }
    @media(max-width:1100px){ .grid{ grid-template-columns:1fr; } .brand{ font-size:18px; } }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div>
        <div class="brand">Agenda Digital — Compartilhada</div>
        <div class="tag">Firestore • notificações • histórico de atividade</div>
      </div>
      <div style="margin-left:auto;display:flex;gap:10px;align-items:center">
        <div id="userInfo" class="muted" style="font-size:13px">Conectando…</div>
        <button id="signBtn" class="btn btn-ghost small">Entrar</button>
      </div>
    </header>

    <div class="grid">
      <!-- Coluna esquerda: formulário -->
      <div>
        <div class="card">
          <h3 style="margin:0 0 10px 0">Criar / Editar evento</h3>
          <form id="eventForm">
            <label for="title">Nome do evento</label>
            <input id="title" required placeholder="Ex: Reunião com equipe" />
            <div class="row">
              <div style="flex:1">
                <label for="date">Data</label>
                <input id="date" type="date" required />
              </div>
              <div style="flex:1">
                <label for="time">Horário</label>
                <input id="time" type="time" required />
              </div>
            </div>
            <label for="creator">Nome do criador</label>
            <input id="creator" placeholder="Seu nome" />
            <label for="notes">Observações</label>
            <textarea id="notes" placeholder="Detalhes do evento"></textarea>
            <div style="margin-top:10px;display:flex;gap:8px">
              <button class="btn btn-primary" type="submit">Salvar evento</button>
              <button type="button" id="resetBtn" class="btn btn-ghost small">Limpar</button>
            </div>
            <input type="hidden" id="editingId" />
          </form>
        </div>

        <div class="card" style="margin-top:14px">
          <h4>Exportar / Importar</h4>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button id="exportJSON" class="btn btn-primary small">Exportar JSON</button>
            <button id="importJSONBtn" class="btn btn-ghost small">Importar JSON</button>
            <input id="importFile" type="file" accept="application/json" style="display:none" />
            <button id="clearAll" class="btn btn-ghost small">Remover todos</button>
          </div>
        </div>
      </div>

      <!-- Coluna central: lista -->
      <div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3>Eventos</h3>
            <input id="search" placeholder="Pesquisar..." style="padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);min-width:200px" />
          </div>
          <div class="events-list" id="eventsList"></div>
        </div>
        <div class="card" style="margin-top:14px;text-align:center">
          <div id="stats" class="muted">Carregando estatísticas…</div>
        </div>
      </div>

      <!-- Coluna direita: atividades -->
      <div>
        <div class="card">
          <h4>Atividades recentes</h4>
          <div class="activity-list" id="activityList">
            <div class="empty">Nenhuma atividade</div>
          </div>
        </div>
      </div>
    </div>

    <footer>Feito com ♥ — substitua <code>firebaseConfig</code> pelo seu projeto Firebase</footer>
  </div>

  <div class="toast-wrap" id="toastWrap"></div>

  <!-- Bibliotecas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <script>
    // CONFIG FIREBASE
    const firebaseConfig = {
      apiKey: "AIzaSyAIdzJHTsvIpUaHszzX8q6jPfR3sh9IfOI",
      authDomain: "agendadigital-44dc9.firebaseapp.com",
      projectId: "agendadigital-44dc9",
      storageBucket: "agendadigital-44dc9.appspot.com",
      messagingSenderId: "569121363405",
      appId: "1:569121363405:web:1c7ab280393c090c40a084"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const userInfo = document.getElementById('userInfo');
    const signBtn = document.getElementById('signBtn');
    const creatorI = document.getElementById('creator');
    const toastWrap = document.getElementById('toastWrap');

    function showToast(text, type='info', ms=4000){
      const el = document.createElement('div');
      el.className = 'toast '+(type==='success'?'success':type==='error'?'error':'info');
      el.textContent = text;
      toastWrap.appendChild(el);
      setTimeout(()=>{ el.style.opacity='0'; setTimeout(()=>el.remove(),500); }, ms);
    }

    let currentUser = null;
    auth.onAuthStateChanged(user=>{
      currentUser = user;
      if(user){
        const name = user.isAnonymous ? 'Usuário anônimo' : (user.displayName || user.email || 'Usuário');
        userInfo.textContent = name;
        signBtn.textContent = user.isAnonymous ? 'Login Google' : 'Sair';
        if(!creatorI.value) creatorI.value = name;
      } else {
        userInfo.textContent = 'Desconectado';
        signBtn.textContent = 'Entrar';
      }
    });

    (async function ensureAnon(){
      try{
        if(!auth.currentUser) await auth.signInAnonymously();
      }catch(e){
        showToast('Erro ao autenticar: '+e.message,'error');
      }
    })();

    auth.getRedirectResult()
      .then(res=>{
        if(res.user) showToast('Login com sucesso!','success');
      })
      .catch(err=> showToast('Erro login: '+err.message,'error'));

    signBtn.addEventListener('click', async ()=>{
      if(currentUser && !currentUser.isAnonymous){
        await auth.signOut();
        await auth.signInAnonymously();
        showToast('Saiu da conta.','info');
        return;
      }
      const provider = new firebase.auth.GoogleAuthProvider();
      try {
        await auth.signInWithRedirect(provider);
      } catch(err){
        showToast('Erro login Google: '+err.message,'error');
      }
    });

    // A partir daqui você pode incluir seu CRUD Firestore normalmente...
  </script>
</body>
</html>
