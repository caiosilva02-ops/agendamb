<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda ClÃ¡ssica Escolar (Noturna)</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=Lora:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://unpkg.com/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
/* VARIÃVEIS DE COR (Biblioteca ClÃ¡ssica Noturna - Corrigido) */
:root {
    --primary-color: #f7e0a7; /* Dourado Suave / Bege (Destaque Principal) */
    --secondary-color: #b08d57; /* Cobre / Ouro Velho (Destaque SecundÃ¡rio) */
    --background-dark: #1e2825; /* Verde Garrafa Escuro / Quase Preto (Fundo) */
    --surface-dark: #2c3a35; /* Fundo dos Cards/PainÃ©is */
    --border-dark: #4a5d58; /* Borda Esverdeada Sutil */
    --text-light: #e0e6e3; /* Texto Claro (Cor de Pergaminho no Escuro) */
    --shadow-rich: 0 6px 15px rgba(0, 0, 0, 0.4);
    --success-color: #4CAF50; /* Verde ClÃ¡ssico para EdiÃ§Ã£o */
    --danger-color: #D32F2F; /* Vermelho Escuro ClÃ¡ssico para Excluir */
}

/* Base e Tipografia */
body { 
    font-family: 'Lora', serif;
    margin: 0; 
    padding: 30px; 
    background: var(--background-dark); 
    color: var(--text-light); 
    transition: background-color 0.5s;
    line-height: 1.6;
}
.container {
    max-width: 1000px; /* Reduzindo max-width para o estilo clÃ¡ssico */
    margin: 0 auto;
    background: var(--surface-dark);
    padding: 40px;
    border: 1px solid var(--border-dark);
    box-shadow: var(--shadow-rich);
}
h1 { 
    font-family: 'Playfair Display', serif;
    color: var(--primary-color); 
    font-weight: 700;
    text-align: center;
    border-bottom: 3px double var(--secondary-color);
    padding-bottom: 10px;
    margin-bottom: 30px;
    font-size: 2.8em;
    text-shadow: 0 0 5px rgba(247, 224, 167, 0.2); /* Sombra dourada sutil */
    text-transform: uppercase;
}
h2 { 
    font-family: 'Playfair Display', serif; 
    color: var(--secondary-color); 
    font-weight: 700;
    border-bottom: 1px solid var(--border-dark); 
    padding-bottom: 5px; 
    margin-top: 35px; 
    font-size: 1.8em;
}
h3 { 
    font-family: 'Lora', serif; 
    color: var(--primary-color); 
    font-weight: 700;
    border-bottom: 1px dashed var(--border-dark); 
    padding-bottom: 5px; 
    margin-top: 0; 
    font-size: 1.2em;
}


/* Layout e FormulÃ¡rio */
.form-section {
    background: #34443e; /* Fundo um pouco mais escuro/saturado para o form */
    padding: 25px;
    border-radius: 5px;
    border: 1px solid var(--border-dark);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    margin-bottom: 30px;
}
.input-group {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}
input, select, textarea { 
    flex-grow: 1; 
    padding: 12px 15px; 
    font-size: 16px; 
    border-radius: 4px; 
    border: 1px solid var(--border-dark); 
    background: var(--background-dark);
    color: var(--text-light);
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);
    transition: border-color 0.3s, box-shadow 0.3s;
    margin: 0;
    font-family: 'Lora', serif;
}
input:focus, select:focus, textarea:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 8px rgba(247, 224, 167, 0.5); /* Dourado no foco */
}
textarea {
    resize: vertical;
    min-height: 100px;
    width: 100%; 
    box-sizing: border-box;
    margin-top: 5px;
}

/* Estilo: Grupo de Seletor de Hora com Ãcone (RelÃ³gio Dourado) */
.time-selector-wrapper {
    display: flex;
    align-items: center;
    border: 1px solid var(--border-dark);
    border-radius: 4px;
    padding: 0 10px;
    background: var(--background-dark);
    flex-grow: 1;
}
.time-selector-icon {
    font-size: 18px;
    color: var(--primary-color); /* Dourado */
    margin-right: 10px;
}
.time-selector-group {
    display: flex;
    gap: 5px;
    flex-grow: 1;
    padding: 8px 0;
}
.time-selector-group select {
    flex-grow: 0;
    width: 80px; 
    padding: 8px 5px; 
    margin: 0;
    border: none; 
    box-shadow: none; 
    background: transparent;
    cursor: pointer;
    font-family: 'Lora', serif;
}


/* BotÃµes (Estilo Mais Formal/Luxuoso) */
button { 
    cursor:pointer; 
    background: var(--primary-color); 
    color: var(--background-dark); /* Texto Escuro no Dourado */
    border: 1px solid var(--primary-color); 
    padding: 12px 25px;
    font-size: 15px;
    font-weight: 700; 
    border-radius: 4px;
    transition: background-color 0.2s, box-shadow 0.2s, color 0.2s;
    margin-top: 15px;
    text-transform: uppercase;
    letter-spacing: 1px;
}
button:hover:not(:disabled) { 
    background: var(--secondary-color); /* Passa para o Cobre */
    border-color: var(--secondary-color);
    color: var(--text-light);
    box-shadow: 0 0 12px rgba(247, 224, 167, 0.4);
}
button:disabled { 
    background: var(--border-dark); 
    color: #888888;
    opacity: 1;
    cursor: not-allowed; 
    box-shadow: none;
    border-color: var(--border-dark);
}
#loginBtn {
    background: var(--secondary-color);
    border-color: var(--secondary-color);
    color: var(--text-light);
    margin-right: 20px;
    text-transform: none; /* Mantendo o padrÃ£o do botÃ£o de login */
}
#loginBtn:hover:not(:disabled) {
    background: var(--background-dark);
    color: var(--primary-color);
    box-shadow: 0 0 12px rgba(247, 224, 167, 0.4);
}
.header-info {
    display: flex;
    align-items: center;
    padding: 10px 0;
    margin-bottom: 20px;
    border-bottom: 1px solid var(--border-dark);
}
#userInfo {
    font-weight: 400;
    color: var(--secondary-color);
    font-style: italic;
    font-size: 0.95em;
}

/* PainÃ©is (Dashboard) - Design de Placas de Bronze */
#dashboard {
    display: flex;
    gap: 30px;
    margin-top: 30px;
    margin-bottom: 40px;
}
.panel {
    flex: 1;
    background: #34443e;
    padding: 20px;
    border-radius: 8px;
    border-left: 5px solid var(--secondary-color);
    box-shadow: var(--shadow-rich);
    transition: transform 0.3s;
}
.panel h3 {
    color: var(--primary-color);
    border-bottom: 1px solid var(--border-dark);
    margin-top: 0;
}
.event-item {
    padding: 10px 0;
    border-bottom: 1px dotted var(--border-dark);
    font-size: 15px;
}
.event-item strong {
    color: var(--secondary-color);
    font-weight: 700;
}
/* Estilo do GrÃ¡fico */
#stats-chart-container {
    height: 200px;
    padding-top: 10px;
}


/* Tabelas (Todos os Eventos) - Estilo de Livro RazÃ£o Noturno */
table { 
    border-collapse: collapse;
    width: 100%; 
    margin-top: 20px; 
    box-shadow: var(--shadow-rich); 
    background: var(--surface-dark); 
    border: 1px solid var(--primary-color);
    border-radius: 8px; /* Mantendo a borda redonda clÃ¡ssica */
    overflow: hidden;
}
th, td { 
    border: 1px solid var(--border-dark);
    padding: 12px 15px; 
    text-align: left;
}
th { 
    background: #3a4b45; 
    font-weight: 700;
    color: var(--primary-color);
    text-transform: uppercase;
    font-size: 13px;
    letter-spacing: 1px;
    border-color: var(--border-dark);
}
tr:nth-child(even) {
    background-color: #26322f; /* Linhas zebradas para contraste */
}

/* BotÃµes de AÃ§Ã£o na Tabela */
.action-btn {
    padding: 8px 15px; 
    font-size: 13px;
    border-radius: 4px;
    margin-right: 8px;
    margin-top: 0;
    font-weight: 700;
    text-transform: none;
}
.edit-btn {
    background: var(--success-color); 
    border-color: var(--success-color);
    color: var(--background-dark);
}
.edit-btn:hover {
    background: #43A047;
    border-color: #43A047;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}
.delete-btn { 
    background: var(--danger-color); 
    border-color: var(--danger-color);
    color: var(--text-light);
}
.delete-btn:hover { 
    background: #C62828; 
    border-color: #C62828;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}
#cancelEdit {
    background: var(--danger-color);
    border-color: var(--danger-color);
    color: var(--text-light);
    text-transform: uppercase;
    letter-spacing: 1px;
}
#cancelEdit:hover {
    background: #C62828;
    border-color: #C62828;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}

/* Estilos do Toast */
.toast {
    position: fixed; right: 20px; bottom: 20px;
    background: var(--secondary-color); 
    color: var(--background-dark); 
    padding: 15px 25px;
    border-radius: 4px; 
    opacity: 0; 
    transition: opacity 0.4s ease, transform 0.4s ease;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
    z-index: 1000;
    font-weight: 700;
    font-size: 16px;
    transform: translateY(100%);
    border: 1px solid var(--primary-color);
}
.toast.show { opacity: 1; transform: translateY(0); }
</style>
</head>
<body>

<div class="container">

Â  Â  <h1>Agenda Virtual Milton Borges Ypiranga</h1>

Â  Â  <div class="header-info">
Â  Â  Â  <button id="loginBtn">Login Google / Sair</button>
Â  Â  Â  <span id="userInfo">Aguardando autenticaÃ§Ã£o...</span>
Â  Â  </div>

Â  Â  <div id="dashboard">
Â  Â  Â  Â  <div class="panel">
Â  Â  Â  Â  Â  Â  <h3>Ãšltimos Criados</h3>
Â  Â  Â  Â  Â  Â  <div id="latestEvents">Carregando...</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="panel">
Â  Â  Â  Â  Â  Â  <h3>PrÃ³ximos Eventos</h3>
Â  Â  Â  Â  Â  Â  <div id="upcomingEvents">Carregando...</div>
Â  Â  Â  Â  </div>
        <div class="panel">
            <h3>EstatÃ­sticas Mensais</h3>
            <div id="stats-chart-container">
                <canvas id="eventsChart"></canvas>
            </div>
        </div>
Â  Â  </div>

Â  Â  <h2>Novo Evento</h2>
Â  Â  <div class="form-section">
Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <input id="title" placeholder="TÃ­tulo" />
Â  Â  Â  Â  Â  Â  <input type="date" id="date" />
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <div class="time-selector-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="time-selector-icon">âŒš</span>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="time-selector-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="timeHour"></select> :Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="timeMinute"></select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <input id="creator" placeholder="Criador" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <textarea id="desc" placeholder="DescriÃ§Ã£o"></textarea>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div style="display: flex; gap: 10px; margin-top: 10px;">
Â  Â  Â  Â  Â  Â  <button id="save" style="flex-grow: 1;">Salvar evento</button>
Â  Â  Â  Â  Â  Â  <button id="cancelEdit" style="display:none; flex-grow: 1; background: var(--danger-color); border-color: var(--danger-color);">Cancelar EdiÃ§Ã£o</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <h2>Todos os Eventos</h2>

    <div class="form-section" style="margin-bottom: 15px;">
        <h3>Filtro por PerÃ­odo</h3>
        <div class="input-group">
            <input type="date" id="filterDateStart" style="flex-grow: 1;" placeholder="Data Inicial"/>
            <input type="date" id="filterDateEnd" style="flex-grow: 1;" placeholder="Data Final"/>
            <button id="applyFilterBtn" style="flex-grow: 0; min-width: 150px; margin-top: 0; font-weight: 500; text-transform: none; letter-spacing: 0;">
                <span id="filterIcon">ğŸ”</span> Aplicar Filtro
            </button>
            <button id="resetFilterBtn" style="flex-grow: 0; min-width: 150px; margin-top: 0; font-weight: 500; background: var(--border-dark); border-color: var(--border-dark); color: var(--text-light); text-transform: none; letter-spacing: 0;">
                Limpar Filtro
            </button>
        </div>
    </div>


Â  Â  <table>
Â  Â  Â  <thead>
Â  Â  Â  Â  <tr><th>TÃ­tulo</th><th>Data</th><th>Hora</th><th>Criador</th><th>DescriÃ§Ã£o</th><th>AÃ§Ãµes</th></tr>
Â  Â  Â  </thead>
Â  Â  Â  <tbody id="eventsBody"><tr><td colspan="6">Carregando eventos...</td></tr></tbody>
Â  Â  </table>

Â  Â  <br>
Â  Â  <button id="pdfBtn" style="margin-bottom: 50px;">ğŸ“„ Gerar PDF da Tabela Atual</button>

</div>

<div id="toast" class="toast"></div>

<script>
// NOTA: Mantenha suas credenciais privadas.
const firebaseConfig = {
Â  apiKey: "AIzaSyAIdzJHTsvIpUaHszzX8q6jPfR3sh9IfOI",
Â  authDomain: "agendadigital-44dc9.firebaseapp.com",
Â  projectId: "agendadigital-44dc9",
Â  storageBucket: "agendadigital-44dc9.firebasestorage.app",
Â  messagingSenderId: "569121363405",
Â  appId: "1:569121363405:web:1c7ab280393c090c40aa72"Â 
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Elementos DOM
const loginBtn = document.getElementById('loginBtn');
const userInfo = document.getElementById('userInfo');
const toast = document.getElementById('toast');
const tbody = document.getElementById('eventsBody');
const titleI = document.getElementById('title');
const dateI = document.getElementById('date');
const timeHourI = document.getElementById('timeHour');
const timeMinuteI = document.getElementById('timeMinute');
const creatorI = document.getElementById('creator');
const descI = document.getElementById('desc');
const saveBtn = document.getElementById('save');
const cancelEditBtn = document.getElementById('cancelEdit');
const latestEventsDiv = document.getElementById('latestEvents');
const upcomingEventsDiv = document.getElementById('upcomingEvents');

// NOVOS ELEMENTOS DO FILTRO
const filterDateStartI = document.getElementById('filterDateStart');
const filterDateEndI = document.getElementById('filterDateEnd');
const applyFilterBtn = document.getElementById('applyFilterBtn');
const resetFilterBtn = document.getElementById('resetFilterBtn');
const filterIcon = document.getElementById('filterIcon');


let currentUser = null;
let currentEditId = null;
let allEventsCache = []; // Cache para armazenar todos os eventos brutos
let eventsChart = null; // VariÃ¡vel para o objeto do grÃ¡fico


function showToast(msg) {
Â  toast.textContent = msg;
Â  toast.classList.add('show');
Â  setTimeout(() => toast.classList.remove('show'), 3000);
}

// ğŸ”¹ InicializaÃ§Ã£o do Seletor de Horas/Minutos
function populateTimeSelectors() {
Â  Â  for (let h = 0; h < 24; h++) {
Â  Â  Â  Â  const hour = h.toString().padStart(2, '0');
Â  Â  Â  Â  const option = new Option(hour, hour);
Â  Â  Â  Â  timeHourI.appendChild(option);
Â  Â  }
Â  Â  for (let m = 0; m < 60; m += 5) { // Incremento de 5 minutos
Â  Â  Â  Â  const minute = m.toString().padStart(2, '0');
Â  Â  Â  Â  const option = new Option(minute, minute);
Â  Â  Â  Â  timeMinuteI.appendChild(option);
Â  Â  }
Â  Â  timeHourI.value = new Date().getHours().toString().padStart(2, '0');
Â  Â  timeMinuteI.value = '00';
}
populateTimeSelectors();


// ğŸ”¹ MantÃ©m login persistente
auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

// ğŸ”¹ Detecta mudanÃ§as de autenticaÃ§Ã£o
auth.onAuthStateChanged(async user => {
Â  if (user) {
Â  Â  currentUser = user;
Â  Â  const name = user.isAnonymous ? 'UsuÃ¡rio anÃ´nimo' : (user.displayName || user.email);
Â  Â  userInfo.textContent = `Logado como: ${name}`;
Â  Â  loginBtn.textContent = user.isAnonymous ? 'Login Google' : 'Sair';
Â  Â  if (!creatorI.value) creatorI.value = name;
Â  } else {
Â  Â  try {
Â  Â  Â  await auth.signInAnonymously();
Â  Â  } catch (err) {
Â  Â  Â  console.error(err);
Â  Â  Â  showToast("Erro ao autenticar anonimamente");
Â  Â  }
Â  }
});

// ğŸ”¹ BotÃ£o de login / logout (Usando Pop-up)
loginBtn.addEventListener('click', async () => {
Â  if (currentUser && !currentUser.isAnonymous) {
Â  Â  await auth.signOut();
Â  Â  showToast("Deslogado com sucesso");
Â  } else {
Â  Â  const provider = new firebase.auth.GoogleAuthProvider();
Â  Â  provider.addScope('profile');
Â  Â  provider.addScope('email');
Â  Â  try {
Â  Â  Â  await auth.signInWithPopup(provider);Â 
Â  Â  Â  showToast("Login Google realizado com sucesso!");
Â  Â  } catch (e) {
Â  Â  Â  console.error(e);
Â  Â  Â  if (e.code !== 'auth/popup-closed-by-user') {
Â  Â  Â  Â  showToast("Erro no login Google");
Â  Â  Â  }
Â  Â  }
Â  }
});

/**
Â * ğŸ”¹ Limpa o formulÃ¡rio e retorna ao modo de criaÃ§Ã£o
Â */
function resetForm() {
Â  Â  titleI.value = '';
Â  Â  dateI.value = '';Â 
Â  Â  descI.value = '';
Â  Â  timeHourI.value = new Date().getHours().toString().padStart(2, '0');
Â  Â  timeMinuteI.value = '00';
Â  Â Â 
Â  Â  currentEditId = null;
Â  Â  saveBtn.textContent = 'Salvar evento';
Â  Â  saveBtn.style.backgroundColor = 'var(--primary-color)';
Â  Â  saveBtn.style.borderColor = 'var(--primary-color)';
Â  Â  saveBtn.style.color = 'var(--background-dark)';
Â  Â  cancelEditBtn.style.display = 'none';
Â  Â Â 
Â  Â  if (currentUser && !currentUser.isAnonymous) {
Â  Â  Â  Â  creatorI.value = currentUser.displayName || currentUser.email || '';
Â  Â  }
}
cancelEditBtn.addEventListener('click', resetForm);


/**
Â * ğŸ”¹ PrÃ©-preenche o formulÃ¡rio para ediÃ§Ã£o
Â * @param {string} id - O ID do documento no Firestore
Â * @param {object} eventData - Os dados do evento
Â */
function editEvent(id, eventData) {
Â  Â  currentEditId = id;
Â  Â Â 
Â  Â  titleI.value = eventData.title || '';
Â  Â  dateI.value = eventData.date || '';
Â  Â  creatorI.value = eventData.creator || '';
Â  Â  descI.value = eventData.desc || '';
Â  Â Â 
Â  Â  const [hour, minute] = (eventData.time || '00:00').split(':');
Â  Â  timeHourI.value = hour.padStart(2, '0');
Â  Â  timeMinuteI.value = minute.padStart(2, '0');
Â  Â Â 
Â  Â  saveBtn.textContent = 'Atualizar evento';
Â  Â  saveBtn.style.backgroundColor = 'var(--success-color)';
Â  Â  saveBtn.style.borderColor = 'var(--success-color)';
Â  Â  saveBtn.style.color = 'var(--background-dark)';
Â  Â  cancelEditBtn.style.display = 'inline-block';
Â  Â Â 
Â  Â  window.scrollTo({ top: 0, behavior: 'smooth' });
}
window.editEvent = editEvent;


/**
Â * ğŸ”¹ FunÃ§Ã£o para deletar um evento
Â * @param {string} id - O ID do documento no Firestore
Â */
async function deleteEvent(id) {
Â  Â  if (!confirm("Tem certeza que deseja excluir este evento?")) {
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  try {
Â  Â  Â  Â  await db.collection('events').doc(id).delete();
Â  Â  Â  Â  showToast("Evento excluÃ­do!");
Â  Â  Â  Â  if (currentEditId === id) {
Â  Â  Â  Â  Â  Â  resetForm();Â 
Â  Â  Â  Â  }
Â  Â  } catch (err) {
Â  Â  Â  Â  console.error("Erro ao excluir evento:", err);
Â  Â  Â  Â  showToast("Erro ao excluir evento");
Â  Â  }
}
window.deleteEvent = deleteEvent;Â 


// ğŸ”¹ Salvar/Atualizar evento
saveBtn.addEventListener('click', async () => {
Â  const title = titleI.value.trim();
Â  const date = dateI.value;
Â  const time = `${timeHourI.value}:${timeMinuteI.value}`;
Â  const creator = creatorI.value.trim();
Â  const desc = descI.value.trim();

Â  if (!title || !date) {
Â  Â  showToast("TÃ­tulo e data sÃ£o obrigatÃ³rios");
Â  Â  return;
Â  }
Â Â 
Â  saveBtn.disabled = true;

Â  try {
Â  Â  const eventData = {
Â  Â  Â  Â  title, date, time, creator, desc,
Â  Â  };
Â  Â Â 
Â  Â  if (currentEditId) {
Â  Â  Â  Â  // MODO DE EDIÃ‡ÃƒO
Â  Â  Â  Â  await db.collection('events').doc(currentEditId).update(eventData);
Â  Â  Â  Â  showToast("Evento atualizado!");
Â  Â  } else {
Â  Â  Â  Â  // MODO DE CRIAÃ‡ÃƒO
Â  Â  Â  Â  eventData.createdBy = currentUser ? currentUser.uid : null;
Â  Â  Â  Â  eventData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
Â  Â  Â  Â  await db.collection('events').add(eventData);
Â  Â  Â  Â  showToast("Evento salvo!");
Â  Â  }
Â  Â Â 
Â  Â  resetForm();

Â  } catch (err) {
Â  Â  console.error(err);
Â  Â  showToast(`Erro ao ${currentEditId ? 'atualizar' : 'salvar'} evento`);
Â  } finally {
Â  Â  saveBtn.disabled = false;
Â  }
});

/**
Â * ğŸ”¹ Renderiza a lista de eventos no painel (todos, prÃ³ximos, ou recentes)
 * @param {Array} events - A lista de eventos a ser renderizada.
 * @param {string} type - Tipo de renderizaÃ§Ã£o ('table' ou 'list').
 * @param {HTMLElement} targetDiv - O elemento DOM alvo (usado apenas para type='list').
Â */
function renderEvents(events, type = 'table', targetDiv = null) {
Â  Â  if (type === 'table') {
Â  Â  Â  Â  tbody.innerHTML = '';
Â  Â  Â  Â  if (events.length === 0) {
Â  Â  Â  Â  Â  Â  tbody.innerHTML = '<tr><td colspan="6" style="color: var(--secondary-color); text-align: center;">Nenhum evento encontrado no perÃ­odo.</td></tr>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  events.forEach(e => {
Â  Â  Â  Â  Â  Â  const tr = document.createElement('tr');
Â  Â  Â  Â  Â  Â  // Escapando o JSON antes de usar em onclick
Â  Â  Â  Â  Â  Â  const eventDataString = JSON.stringify({
Â  Â  Â  Â  Â  Â  Â  Â  title: e.title,
Â  Â  Â  Â  Â  Â  Â  Â  date: e.date,
Â  Â  Â  Â  Â  Â  Â  Â  time: e.time,
Â  Â  Â  Â  Â  Â  Â  Â  creator: e.creator,
Â  Â  Â  Â  Â  Â  Â  Â  desc: e.desc
Â  Â  Â  Â  Â  Â  }).replace(/"/g, "'");Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  tr.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <td>${e.title || ''}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${e.date || ''}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${e.time || ''}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${e.creator || ''}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>${e.desc || ''}</td>
Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="action-btn edit-btn"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="editEvent('${e.id}', ${eventDataString})">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Editar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="action-btn delete-btn" onclick="deleteEvent('${e.id}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Excluir
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  tbody.appendChild(tr);
Â  Â  Â  Â  });
Â  Â  } else if (type === 'list' && targetDiv) {
Â  Â  Â  Â  targetDiv.innerHTML = '';
Â  Â  Â  Â  if (events.length === 0) {
Â  Â  Â  Â  Â  Â  Â targetDiv.innerHTML = '<p style="margin: 0; font-size:12px; color: var(--secondary-color);">Nenhum evento encontrado.</p>';
Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  }
Â  Â  Â  Â  events.forEach(e => {
Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  div.className = 'event-item';
Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <strong>${e.date} ${e.time}</strong>: ${e.title} (Criador: ${e.creator})
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  targetDiv.appendChild(div);
Â  Â  Â  Â  });
Â  Â  }
}

/**
 * ğŸ”¹ Filtra os eventos do cache pelo perÃ­odo selecionado.
 * @param {Array} events - Lista de eventos a serem filtrados.
 * @param {string} start - Data de inÃ­cio (YYYY-MM-DD).
 * @param {string} end - Data final (YYYY-MM-DD).
 * @returns {Array} Eventos filtrados.
 */
function filterEventsByDate(events, start, end) {
    if (!start && !end) return events;

    const startDate = start ? new Date(start) : null;
    const endDate = end ? new Date(end) : null;

    if (endDate) {
        // Ajusta a data final para incluir o dia inteiro
        endDate.setDate(endDate.getDate() + 1);
        endDate.setMilliseconds(endDate.getMilliseconds() - 1);
    }

    return events.filter(e => {
        // Tenta criar a data e hora. Se o tempo for 00:00, apenas a data Ã© usada.
        const eventDateTimeString = e.date + (e.time ? `T${e.time}` : 'T00:00:00');
        const eventDate = new Date(eventDateTimeString); 
        
        let isAfterStart = true;
        let isBeforeEnd = true;

        if (startDate) {
            isAfterStart = eventDate >= startDate;
        }

        if (endDate) {
            // A data do evento deve ser menor ou igual ao final do dia final
            isBeforeEnd = eventDate <= endDate;
        }

        return isAfterStart && isBeforeEnd;
    }).sort((a, b) => {
        // Garante a ordenaÃ§Ã£o correta apÃ³s a filtragem
        if (a.date < b.date) return -1;
        if (a.date > b.date) return 1;
        if (a.time < b.time) return -1;
        if (a.time > b.time) return 1;
        return 0;
    });
}

/**
 * ğŸ”¹ Aplica o filtro de data e renderiza a tabela principal.
 */
function applyFilterAndRender() {
    const start = filterDateStartI.value;
    const end = filterDateEndI.value;
    
    // Altera Ã­cone para indicar filtragem ativa
    if (start || end) {
        filterIcon.textContent = 'âœ…';
    } else {
        filterIcon.textContent = 'ğŸ”';
    }

    const filteredEvents = filterEventsByDate(allEventsCache, start, end);
    renderEvents(filteredEvents, 'table');

    if (start && end) {
        showToast(`Filtro aplicado: ${start} a ${end}.`);
    } else if (start) {
        showToast(`Filtro aplicado: A partir de ${start}.`);
    } else if (end) {
        showToast(`Filtro aplicado: AtÃ© ${end}.`);
    } else {
        // NÃ£o mostra toast ao limpar filtro
